<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro – Painel Afiliados</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonte Inter para combinar com index.html -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Ícones Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
      transform: translateY(20px);
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Estilos personalizados para inputs (Glassmorphism) */
    .input-dark {
      background-color: rgb(15 23 42); /* slate-900 */
      border-color: rgb(51 65 85); /* slate-700 */
      color: rgb(241 245 249); /* slate-100 */
    }
    .input-dark:focus {
      border-color: rgb(14 165 233); /* sky-500 */
      ring-color: rgba(14, 165, 233, 0.4);
    }
    .input-dark::placeholder {
      color: rgb(100 116 139); /* slate-500 */
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-950 via-sky-950 to-indigo-900 min-h-screen flex items-center justify-center px-4 py-12">

  <!-- Main Card Container -->
  <div class="fade-in-up w-full max-w-3xl bg-slate-950/95 border border-slate-800 rounded-2xl shadow-2xl shadow-black/60 flex flex-col relative">
    
    <!-- Cabeçalho do Card -->
    <div class="px-8 pt-8 pb-4 text-center border-b border-slate-800/50">
      <img
        src="https://pegdobrasil.cdn.magazord.com.br/img/2025/11/produto/161412/logobonita-e-formosa.png"
        alt="PEG do Brasil"
        class="h-12 w-auto mx-auto drop-shadow-md mb-3"
      >
      <h1 class="text-2xl font-bold text-slate-50 tracking-tight">Crie sua Conta</h1>
      <p class="text-slate-400 text-sm mt-1">Preencha os dados abaixo para se tornar um afiliado.</p>
    </div>

    <!-- Corpo do Formulário -->
    <div class="p-8 space-y-8">
      
      <!-- Seção 1: Dados do Afiliado -->
      <section class="space-y-5">
        <h2 class="text-sm font-semibold text-sky-400 uppercase tracking-wider flex items-center gap-2">
          <i data-lucide="user" class="w-4 h-4"></i> Dados Pessoais
        </h2>

        <!-- Select Oculto (Mantido para compatibilidade com auth.js) -->
        <div class="hidden">
           <select id="tipo_pessoa">
             <option value="PF">Pessoa Física (CPF)</option>
             <option value="PJ">Pessoa Jurídica (CNPJ)</option>
           </select>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <!-- CPF/CNPJ (Automático e Validado) -->
          <div class="relative">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">CPF / CNPJ</label>
            <input 
              id="cpf_cnpj" 
              type="text" 
              placeholder="Digite apenas números"
              maxlength="18"
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
            <!-- Mensagem de erro de CPF/CNPJ -->
            <span id="cpf-cnpj-error" class="hidden absolute -bottom-5 left-1 text-[10px] text-red-400 font-medium">
              Documento inválido. Verifique os números digitados.
            </span>
          </div>

          <!-- Nome Completo -->
          <div>
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Nome completo / Razão social</label>
            <input 
              id="nome" 
              type="text" 
              placeholder="Seu nome aqui"
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <!-- Email -->
          <div class="relative">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Email</label>
            <input 
              id="email" 
              type="email" 
              placeholder="seu@email.com"
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
            <!-- Mensagem de erro de email -->
            <span id="email-error" class="hidden absolute -bottom-5 left-1 text-[10px] text-red-400 font-medium">
              Formatação de e-mail incorreto (obrigatório @)
            </span>
          </div>

          <!-- Telefone (Alterado Label) -->
          <div>
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Telefone Fixo ou Celular</label>
            <input 
              id="telefone" 
              type="tel" 
              placeholder="" 
              maxlength="15"
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <!-- Senha (Placeholder ajustado) -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Senha</label>
            <div class="relative">
              <input 
                id="senha" 
                type="password" 
                placeholder="********"
                class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark pr-24"
              >
              <!-- Indicador visual dentro do input à direita -->
              <div class="absolute inset-y-0 right-3 flex items-center gap-2">
                <span id="senha-texto" class="text-xs font-semibold text-slate-500"></span>
                <div id="senha-indicador" class="w-3 h-3 rounded-full bg-slate-700 transition-colors duration-300"></div>
              </div>
            </div>
            <!-- Mensagem de erro de senha curta -->
            <span id="senha-error" class="hidden text-[10px] text-red-400 font-medium ml-1 mt-1 block">
              A senha deve ter no mínimo 8 caracteres.
            </span>
          </div>
        </div>
      </section>

      <hr class="border-slate-800">

      <!-- Seção 2: Endereço -->
      <section class="space-y-5">
        <h2 class="text-sm font-semibold text-sky-400 uppercase tracking-wider flex items-center gap-2">
          <i data-lucide="map-pin" class="w-4 h-4"></i> Endereço
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-5">
          
          <!-- Linha 1: CEP e Número (Lado a lado) -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">CEP</label>
            <div class="relative">
              <input 
                id="cep" 
                type="text" 
                placeholder="00000-000"
                onblur="buscarCep()"
                maxlength="9"
                class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
              >
              <div class="absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-500">
                <i data-lucide="search" class="w-4 h-4"></i>
              </div>
            </div>
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Número</label>
            <input 
              id="numero" 
              type="text" 
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <div class="md:col-span-4">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Logradouro</label>
            <input 
              id="logradouro" 
              type="text" 
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Bairro</label>
            <input 
              id="bairro" 
              type="text" 
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Cidade</label>
            <input 
              id="cidade" 
              type="text" 
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">UF</label>
            <input 
              id="uf" 
              type="text" 
              maxlength="2" 
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark uppercase text-center"
            >
          </div>

          <div class="md:col-span-4">
            <label class="block text-sm font-medium text-slate-200 mb-1.5 ml-1">Complemento</label>
            <input 
              id="complemento" 
              type="text" 
              placeholder="Apto, Bloco, Referência..."
              class="w-full px-4 py-3 rounded-xl border transition-all duration-200 focus:outline-none focus:ring-2 input-dark"
            >
          </div>

        </div>
      </section>

      <div id="email-verification-area" class="hidden bg-sky-500/10 border border-sky-500/20 rounded-xl p-4 flex items-start gap-3">
        <i data-lucide="mail-check" class="w-5 h-5 text-sky-400 mt-0.5"></i>
        <div>
          <h4 class="text-sm font-semibold text-sky-100">Verifique seu e-mail</h4>
          <p class="text-xs text-sky-200/80 mt-1">
            Enviamos um código de verificação para o seu e-mail. Por favor, confirme para continuar.
          </p>
        </div>
      </div>

      <div class="pt-4 flex flex-col md:flex-row gap-4">
        <button 
          type="button"
          onclick="register()" 
          class="flex-1 bg-sky-500 hover:bg-sky-400 text-slate-950 font-bold py-3.5 rounded-xl shadow-lg shadow-sky-500/40 transform hover:-translate-y-0.5 transition-all duration-200 active:scale-[0.98]"
        >
          Salvar Cadastro
        </button>
        
        <a href="index.html" 
           class="flex-1 flex items-center justify-center bg-slate-800 hover:bg-slate-700 text-slate-200 font-semibold py-3.5 rounded-xl border border-slate-700 transition-all duration-200"
        >
          Voltar ao Login
        </a>
      </div>

    </div>
  </div>

  <script src="auth.js"></script>

  <!-- Script para Lógica de Interface -->
  <script>
    lucide.createIcons();

    // --- 1. Lógica CPF/CNPJ Automático e VALIDAÇÃO ---
    const cpfCnpjInput = document.getElementById('cpf_cnpj');
    const tipoPessoaSelect = document.getElementById('tipo_pessoa');
    const cpfCnpjError = document.getElementById('cpf-cnpj-error');

    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf == '') return false;
      if (cpf.length != 11 || 
          cpf == "00000000000" || 
          cpf == "11111111111" || 
          cpf == "22222222222" || 
          cpf == "33333333333" || 
          cpf == "44444444444" || 
          cpf == "55555555555" || 
          cpf == "66666666666" || 
          cpf == "77777777777" || 
          cpf == "88888888888" || 
          cpf == "99999999999")
          return false;
      let add = 0;
      for (let i = 0; i < 9; i++) add += parseInt(cpf.charAt(i)) * (10 - i);
      let rev = 11 - (add % 11);
      if (rev == 10 || rev == 11) rev = 0;
      if (rev != parseInt(cpf.charAt(9))) return false;
      add = 0;
      for (let i = 0; i < 10; i++) add += parseInt(cpf.charAt(i)) * (11 - i);
      rev = 11 - (add % 11);
      if (rev == 10 || rev == 11) rev = 0;
      if (rev != parseInt(cpf.charAt(10))) return false;
      return true;
    }

    function validarCNPJ(cnpj) {
      cnpj = cnpj.replace(/[^\d]+/g, '');
      if (cnpj == '') return false;
      if (cnpj.length != 14) return false;
      if (/^(\d)\1+$/.test(cnpj)) return false;
      let tamanho = cnpj.length - 2;
      let numeros = cnpj.substring(0,tamanho);
      let digitos = cnpj.substring(tamanho);
      let soma = 0;
      let pos = tamanho - 7;
      for (let i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
      }
      let resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
      if (resultado != digitos.charAt(0)) return false;
      tamanho = tamanho + 1;
      numeros = cnpj.substring(0,tamanho);
      soma = 0;
      pos = tamanho - 7;
      for (let i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
      }
      resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
      if (resultado != digitos.charAt(1)) return false;
      return true;
    }

    function verificarValidadeCpfCnpj() {
        const val = cpfCnpjInput.value.replace(/\D/g, '');
        let isValid = false;

        if (val.length === 11) {
            isValid = validarCPF(val);
        } else if (val.length === 14) {
            isValid = validarCNPJ(val);
        } else if (val.length === 0) {
            isValid = true; 
        } else {
            isValid = false;
        }

        if (!isValid && val.length > 0) {
            cpfCnpjError.classList.remove('hidden');
            cpfCnpjInput.classList.add('border-red-500', 'focus:ring-red-500/40');
            cpfCnpjInput.classList.remove('focus:ring-sky-500/40');
        } else {
            cpfCnpjError.classList.add('hidden');
            cpfCnpjInput.classList.remove('border-red-500', 'focus:ring-red-500/40');
            cpfCnpjInput.classList.add('focus:ring-sky-500/40');
        }
    }

    cpfCnpjInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, ''); 
      if (value.length > 11) {
        tipoPessoaSelect.value = 'PJ';
        e.target.value = value
          .replace(/^(\d{2})(\d)/, '$1.$2')
          .replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3')
          .replace(/\.(\d{3})(\d)/, '.$1/$2')
          .replace(/(\d{4})(\d)/, '$1-$2')
          .slice(0, 18);
      } else {
        tipoPessoaSelect.value = 'PF';
        e.target.value = value
          .replace(/(\d{3})(\d)/, '$1.$2')
          .replace(/(\d{3})(\d)/, '$1.$2')
          .replace(/(\d{3})(\d{1,2})/, '$1-$2')
          .replace(/(-\d{2})\d+?$/, '$1');
      }
      cpfCnpjError.classList.add('hidden');
      cpfCnpjInput.classList.remove('border-red-500');
    });

    cpfCnpjInput.addEventListener('blur', verificarValidadeCpfCnpj);

    // --- 2. Validação de Email ---
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('email-error');

    emailInput.addEventListener('input', function() {
      const val = emailInput.value;
      if (val.length > 0 && !val.includes('@')) {
        emailError.classList.remove('hidden');
        emailInput.classList.add('border-red-500', 'focus:ring-red-500/40');
        emailInput.classList.remove('focus:ring-sky-500/40');
      } else {
        emailError.classList.add('hidden');
        emailInput.classList.remove('border-red-500', 'focus:ring-red-500/40');
        emailInput.classList.add('focus:ring-sky-500/40');
      }
    });

    // --- 3. Máscara de Telefone ---
    const telefoneInput = document.getElementById('telefone');
    
    telefoneInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      if (value.length > 10) {
        value = value.replace(/^(\d{2})(\d{1})(\d{4})(\d{4}).*/, '($1) $2 $3-$4');
      } else if (value.length > 6) {
        value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, '($1) $2-$3');
      } else if (value.length > 2) {
        value = value.replace(/^(\d{2})(\d{0,5}).*/, '($1) $2');
      }
      e.target.value = value;
    });

    // --- 4. Medidor de Senha ---
    const senhaInput = document.getElementById('senha');
    const indicador = document.getElementById('senha-indicador');
    const senhaTexto = document.getElementById('senha-texto');
    const senhaError = document.getElementById('senha-error');

    senhaInput.addEventListener('input', function() {
      const val = senhaInput.value;
      let forca = 0;

      if (val.length > 0 && val.length < 8) {
        senhaError.classList.remove('hidden');
        senhaInput.classList.add('border-red-500');
        senhaInput.classList.remove('focus:ring-sky-500/40');
      } else {
        senhaError.classList.add('hidden');
        senhaInput.classList.remove('border-red-500');
        senhaInput.classList.add('focus:ring-sky-500/40');
      }

      if (val.length >= 8) forca++;
      if (/[A-Z]/.test(val) && /[0-9]/.test(val)) forca++;
      if (/[^A-Za-z0-9]/.test(val)) forca++;

      indicador.className = 'w-3 h-3 rounded-full transition-colors duration-300 bg-slate-700';
      senhaTexto.innerText = '';

      if (val.length === 0) return;

      if (val.length < 8) {
        indicador.classList.add('bg-red-900');
        return; 
      }

      if (forca < 2) { 
        indicador.classList.add('bg-green-500', 'shadow-[0_0_8px_rgba(34,197,94,0.6)]');
        senhaTexto.innerText = 'Fraca';
        senhaTexto.className = 'text-xs font-semibold text-green-500';
      } else if (forca < 3) {
        indicador.classList.add('bg-yellow-500', 'shadow-[0_0_8px_rgba(234,179,8,0.6)]');
        senhaTexto.innerText = 'Média';
        senhaTexto.className = 'text-xs font-semibold text-yellow-500';
      } else {
        indicador.classList.add('bg-red-600', 'shadow-[0_0_8px_rgba(220,38,38,0.6)]');
        senhaTexto.innerText = 'Forte';
        senhaTexto.className = 'text-xs font-semibold text-red-500';
      }
    });

    // --- 5. CEP ---
    const cepInput = document.getElementById('cep');

    cepInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 8) value = value.slice(0, 8);
      if (value.length > 5) {
        value = value.replace(/^(\d{5})(\d)/, '$1-$2');
      }
      e.target.value = value;
    });

    async function buscarCep() {
      const logradouro = document.getElementById('logradouro');
      const bairro = document.getElementById('bairro');
      const cidade = document.getElementById('cidade');
      const uf = document.getElementById('uf');
      const numero = document.getElementById('numero');
      
      const cep = cepInput.value.replace(/\D/g, '');

      if (cep.length !== 8) return;

      try {
        logradouro.placeholder = "Buscando...";
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const data = await response.json();

        if (data.erro) {
          alert("CEP não encontrado.");
          logradouro.placeholder = "";
          return;
        }

        logradouro.value = data.logradouro;
        bairro.value = data.bairro;
        cidade.value = data.localidade;
        uf.value = data.uf;
        numero.focus();

      } catch (error) {
        console.error("Erro ao buscar CEP:", error);
      } finally {
        if(!logradouro.value) logradouro.placeholder = "";
      }
    }
  </script>
</body>
</html>
